// Expo Settings
pluginManagement {
  def version = providers.exec {
    commandLine("node", "-e", "console.log(require('react-native/package.json').version);")
  }.standardOutput.asText.get().trim()
  def (_, reactNativeMinor, reactNativePatch) = version.split("\\.")

  repositories {
    gradlePluginPortal()
    google()
    mavenCentral()
  }

  plugins {
    id("com.facebook.react.settings") version "${reactNativeMinor}.${reactNativePatch}.+"
  }
}

plugins {
  id("com.facebook.react.settings")
  id("expo-gradle-plugin-autolinking-settings") version "3.0.0"
}

// React Native build settings
def getRNMinorVersion() {
  def version = providers.exec {
    commandLine("node", "-e", "console.log(require('react-native/package.json').version);")
  }.standardOutput.asText.get().trim()
  def coreVersion = version.split("-")[0]
  def (major, minor, patch) = coreVersion.tokenize('.')
  return minor.toInteger()
}

def rnMinorVersion = getRNMinorVersion()

// Root project settings
rootProject.name = 'asacbrilleapp'

// Auto-configure React Native settings
apply from: new File(["node", "--print", "require.resolve('expo/package.json')"].execute(null, rootDir).text.trim(), "../scripts/autolinking.gradle");
useExpoModules()

// Include app
include ':app'
project(':app').projectDir = new File(rootDir, 'app')

// Configure React Native
if (rnMinorVersion >= 71) {
  apply from: new File(["node", "--print", "require.resolve('react-native/package.json')"].execute(null, rootDir).text.trim(), "../react.gradle")
}