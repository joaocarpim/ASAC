# =========================================
# === Usu√°rio ===
# =========================================
type User
  @model
  @auth(
    rules: [
      # üîì P√∫blico pode apenas ler (ranking, perfis p√∫blicos)
      { allow: public, provider: apiKey, operations: [read] }

      # üë§ Dono (owner) pode criar, ler e atualizar seus pr√≥prios dados
      { allow: owner, ownerField: "id", operations: [create, read, update, delete] }

      # üîê Usu√°rio autenticado (sem grupo) tamb√©m pode gerenciar dados
      { allow: private, provider: userPools, operations: [create, read, update, delete] }

      # üõ†Ô∏è Grupo Admins pode tudo
      { allow: groups, groups: ["Admins"], operations: [create, read, update, delete] }
    ]
  ) {
  id: ID! @primaryKey
  name: String!
  email: String! @index(name: "byEmail")
  role: String!
  coins: Int
  points: Int
  modulesCompleted: [Int]
  currentModule: Int
  precision: Float
  correctAnswers: Int
  wrongAnswers: Int
  timeSpent: Float

  # Relacionamentos
  achievements: [Achievement] @hasMany(indexName: "byUser", fields: ["id"])
  progress: [Progress] @hasMany(indexName: "byUser", fields: ["id"])
}

# =========================================
# === Conquistas (Achievements) ===
# =========================================
type Achievement
  @model
  @auth(
    rules: [
      # P√∫blico pode ler (para exibir conquistas desbloqueadas)
      { allow: public, provider: apiKey, operations: [read] }

      # Dono da conquista pode criar, ler, atualizar e deletar
      { allow: owner, ownerField: "userId", operations: [create, read, update, delete] }

      # Usu√°rios autenticados tamb√©m podem interagir
      { allow: private, provider: userPools, operations: [create, read, update, delete] }

      # Admins t√™m permiss√£o total
      { allow: groups, groups: ["Admins"], operations: [create, read, update, delete] }
    ]
  ) {
  id: ID!
  title: String!
  description: String
  moduleNumber: Int
  userId: ID! @index(name: "byUser")
  user: User @belongsTo(fields: ["userId"])
}

# =========================================
# === Progresso do Usu√°rio ===
# =========================================
type Progress
  @model
  @auth(
    rules: [
      # Leitura p√∫blica (ranking e estat√≠sticas globais)
      { allow: public, provider: apiKey, operations: [read] }

      # Dono pode criar e atualizar seu progresso
      { allow: owner, ownerField: "userId", operations: [create, read, update, delete] }

      # Usu√°rios autenticados t√™m permiss√£o total em seu progresso
      { allow: private, provider: userPools, operations: [create, read, update, delete] }

      # Admins podem acessar e gerenciar todos
      { allow: groups, groups: ["Admins"], operations: [create, read, update, delete] }
    ]
  ) {
  id: ID!
  userId: ID! @index(name: "byUser")
  user: User @belongsTo(fields: ["userId"])

  moduleId: ID! @index(name: "byModule")
  module: Module @belongsTo(fields: ["moduleId"])

  moduleNumber: Int
  accuracy: Float
  correctAnswers: Int
  wrongAnswers: Int
  timeSpent: Float
  completed: Boolean
  completedAt: AWSDateTime
  errorDetails: String
}

# =========================================
# === M√≥dulo ===
# =========================================
type Module
  @model
  @auth(
    rules: [
      # Qualquer um pode ler os m√≥dulos
      { allow: public, provider: apiKey, operations: [read] }
      { allow: private, provider: userPools, operations: [read] }
      # Somente Admins podem criar ou editar m√≥dulos
      { allow: groups, groups: ["Admins"], operations: [create, read, update, delete] }
    ]
  ) {
  id: ID!
  title: String!
  description: String!
  moduleNumber: Int!

  lessons: [Lesson] @hasMany(indexName: "byModule", fields: ["id"])
  questions: [Question] @hasMany(indexName: "byModule", fields: ["id"])
  progress: [Progress] @hasMany(indexName: "byModule", fields: ["id"])
}

# =========================================
# === Li√ß√µes (Lessons) ===
# =========================================
type Lesson
  @model
  @auth(
    rules: [
      { allow: public, provider: apiKey, operations: [read] }
      { allow: private, provider: userPools, operations: [read] }
      { allow: groups, groups: ["Admins"], operations: [create, read, update, delete] }
    ]
  ) {
  id: ID!
  title: String!
  content: String!
  image: String
  lessonNumber: Int!
  moduleId: ID! @index(name: "byModule", sortKeyFields: ["lessonNumber"])
  module: Module @belongsTo(fields: ["moduleId"])
}

# =========================================
# === Quest√µes (Questions) ===
# =========================================
type Question
  @model
  @auth(
    rules: [
      { allow: public, provider: apiKey, operations: [read] }
      { allow: private, provider: userPools, operations: [read] }
      { allow: groups, groups: ["Admins"], operations: [create, read, update, delete] }
    ]
  ) {
  id: ID!
  questionText: String!
  options: [String!]!
  correctAnswerIndex: Int!
  moduleId: ID! @index(name: "byModule")
  module: Module @belongsTo(fields: ["moduleId"])
}

# =========================================
# === S√≠mbolos Braille ===
# =========================================
type BrailleSymbol
  @model
  @auth(
    rules: [
      { allow: public, provider: apiKey, operations: [read] }
      { allow: private, provider: userPools, operations: [read] }
      { allow: groups, groups: ["Admins"], operations: [create, read, update, delete] }
    ]
  ) {
  id: ID!
  letter: String!
  description: String!
  imageKey: String!
}

# =========================================
# === Mutations personalizadas ===
# =========================================
type Mutation {
  adminRegisterUser(name: String!, email: String!, password: String!): String
    @function(name: "AdminRegisterUser-${env}")
    @auth(rules: [{ allow: groups, groups: ["Admins"] }])
}
